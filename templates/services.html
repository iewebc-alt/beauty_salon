{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card p-3 shadow-sm">
            <h5 id="formTitle">➕ Добавить услугу</h5>
            <form onsubmit="handleFormSubmit(event)">
                <input type="hidden" id="serviceId">
                <div class="mb-3">
                    <label>Название</label>
                    <input type="text" id="name" name="name" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Цена (руб)</label>
                    <input type="number" id="price" name="price" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Длительность (мин)</label>
                    <input type="number" id="duration" name="duration_minutes" class="form-control" required>
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" id="submitBtn" class="btn btn-success flex-grow-1">Сохранить</button>
                    <button type="button" id="cancelBtn" class="btn btn-secondary" style="display:none;" onclick="resetForm()">Отмена</button>
                </div>
            </form>
        </div>
    </div>
    <div class="col-md-8">
        <table class="table table-striped bg-white rounded shadow-sm align-middle">
            <thead><tr><th>Название</th><th>Цена</th><th>Время</th><th>Действия</th></tr></thead>
            <tbody>
                {% for service in services %}
                <tr>
                    <td>{{ service.name }}</td>
                    <td>{{ service.price }} ₽</td>
                    <td>{{ service.duration_minutes }} мин</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editService({{ service.id }}, '{{ service.name }}', {{ service.price }}, {{ service.duration_minutes }})"><i class="fas fa-pen"></i></button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function editService(id, name, price, duration) {
        document.getElementById('serviceId').value = id;
        document.getElementById('name').value = name;
        document.getElementById('price').value = price;
        document.getElementById('duration').value = duration;
        document.getElementById('formTitle').innerText = '✏️ Редактировать услугу';
        document.getElementById('submitBtn').innerText = 'Обновить';
        document.getElementById('submitBtn').classList.replace('btn-success', 'btn-primary');
        document.getElementById('cancelBtn').style.display = 'block';
    }
    function resetForm() {
        document.querySelector('form').reset();
        document.getElementById('serviceId').value = '';
        document.getElementById('formTitle').innerText = '➕ Добавить услугу';
        document.getElementById('submitBtn').innerText = 'Сохранить';
        document.getElementById('submitBtn').classList.replace('btn-primary', 'btn-success');
        document.getElementById('cancelBtn').style.display = 'none';
    }
    async function handleFormSubmit(event) {
        event.preventDefault();
        const id = document.getElementById('serviceId').value;
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());
        let url = '/api/v1/services';
        let method = 'POST';
        if (id) { url = `/api/v1/services/${id}`; method = 'PUT'; }
        const res = await apiRequest(url, method, data);
        if (res) location.reload();
    }
</script>
{% endblock %}
EOF
